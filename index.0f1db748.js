function t(e){return e.map(function(e){return Array.isArray(e)?t(e):e})}const e=new class{constructor(e){this.score=0,this.status="idle",this.initialState=t(e||[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]),this.board=t(this.initialState)}addNewCell(){let t=[];for(let e=0;e<4;e++)for(let s=0;s<4;s++)0===this.board[e][s]&&t.push({row:e,col:s});if(t.length>0){let{row:e,col:s}=t[Math.floor(Math.random()*t.length)];this.board[e][s]=.9>Math.random()?2:4}}moveLeft(){"playing"===this.status&&this.move(t=>t,(t,e,s)=>{for(let r=0;r<4;r++)t[s][r]=e[r]})}moveRight(){"playing"===this.status&&this.move(t=>t.slice().reverse(),(t,e,s)=>{for(let r=0;r<4;r++)t[s][r]=e[3-r]})}moveUp(){"playing"===this.status&&this.move((t,e)=>this.board.map(t=>t[e]),(t,e,s)=>{for(let r=0;r<4;r++)t[r][s]=e[r]})}moveDown(){"playing"===this.status&&this.move((t,e)=>this.board.map(t=>t[e]).reverse(),(t,e,s)=>{e.reverse();for(let r=0;r<4;r++)t[r][s]=e[r]})}move(t,e){let s=!1;for(let r=0;r<4;r++){let a=t(this.board[r],r),o=this.combine(a);o.join("")!==a.join("")&&(s=!0),e(this.board,o,r)}s&&(this.addNewCell(),this.checkGameStatus())}combine(t){let e=t.filter(t=>0!==t),s=0,r=[];for(let t=0;t<e.length;t++)e[t]===e[t+1]?(r.push(2*e[t]),s+=2*e[t],e[t+1]=0,t++):r.push(e[t]);for(this.score+=s;r.length<4;)r.push(0);return r}checkGameStatus(){this.board.flat().includes(2048)?this.status="win":this.canMove()||(this.status="lose")}canMove(){for(let t=0;t<4;t++)for(let e=0;e<4;e++)if(0===this.board[t][e]||3!==e&&this.board[t][e]===this.board[t][e+1]||3!==t&&this.board[t][e]===this.board[t+1][e])return!0;return!1}getScore(){return this.score}getState(){return this.board}getStatus(){return this.status}start(){"idle"===this.status&&(this.status="playing",this.addNewCell(),this.addNewCell())}restart(){this.board=t(this.initialState),this.score=0,this.status="idle"}},s={left:"ArrowLeft",right:"ArrowRight",up:"ArrowUp",down:"ArrowDown"};document.addEventListener("DOMContentLoaded",function(){let t=document.querySelector(".game-field"),r=document.querySelector(".game-score"),a=document.querySelector(".start"),o=document.querySelector(".message-start"),i=document.querySelector(".message-lose"),n=document.querySelector(".message-win");function l(){t.innerHTML="",e.getState().forEach(e=>{let s=document.createElement("tr");s.classList.add("field-row"),e.forEach(t=>{let e=document.createElement("td");e.classList.add("field-cell"),0!==t&&(e.classList.add(`field-cell--${t}`),e.textContent=t),s.appendChild(e)}),t.appendChild(s)})}function d(){r.textContent=e.getScore()}function c(){o.classList.toggle("hidden","idle"!==e.getStatus()),i.classList.toggle("hidden","lose"!==e.getStatus()),n.classList.toggle("hidden","win"!==e.getStatus())}a.addEventListener("click",()=>{"Start"===a.textContent?(e.start(),a.textContent="Restart",a.classList.replace("start","restart")):(e.restart(),d(0),a.textContent="Start",a.classList.replace("restart","start")),l(),d(),c()}),document.addEventListener("keydown",t=>{let r=t.key;if(Object.values(s).includes(r)){switch(t.preventDefault(),r){case s.left:e.moveLeft();break;case s.right:e.moveRight();break;case s.up:e.moveUp();break;case s.down:e.moveDown()}l(),d(),c()}})});
//# sourceMappingURL=index.0f1db748.js.map
